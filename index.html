<!DOCTYPE html>
<html lang="bs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Prijava na Centrotours Workshop | Ljeto 2026 u Turskoj</title>
  <link rel="icon" href="favicon.ico" />
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    :root{
      --primary:#0ea5e9; --accent:#22c55e; --bg:#eef9ff; --text:#0b1a2b; --muted:#44627d;
      --radius:18px; --shadow:0 14px 44px rgba(2,132,199,.18); --border:1px solid rgba(2,132,199,.18);
      --focus:0 0 0 4px rgba(14,165,233,.22);
    }
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, Helvetica, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1400px 800px at 10% -20%, #e0f7ff 0%, transparent 80%),
        radial-gradient(1400px 800px at 110% 10%, #d1f7ff 0%, transparent 80%),
        linear-gradient(180deg, #c7f1ff 0%, #f3fbff 100%);
      background-attachment: fixed;
      overflow-x: hidden;
    }
    .hero-bg{position:fixed; inset:0; background-position:center; background-size:cover; opacity:.22; z-index:-1; transition:background-image .6s ease}
    .hero-bg::after{
      content:""; position:absolute; inset:0;
      background:
        radial-gradient(500px 500px at 85% 10%, rgba(255,235,140,.50), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.45), rgba(255,255,255,0));
      pointer-events:none;
    }

    /* Header */
    header.sticky{
      position:sticky; top:0; z-index:50; backdrop-filter:saturate(130%) blur(10px);
      background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.75));
      border-bottom:var(--border);
    }
    .wrap{max-width:1120px; margin:0 auto; padding:12px 16px}
    .headerRow{display:grid; grid-template-columns:auto 1fr; gap:12px; align-items:center}
    .logo{height:40px; filter:drop-shadow(0 4px 10px rgba(2,132,199,.25))}
    .brand-soft{font-weight:700; color:#13405a; opacity:.85}
    .badgeRow{display:flex; flex-wrap:wrap; gap:10px; margin-top:8px}
    .pbadge{
      display:inline-flex; align-items:center; gap:8px; padding:10px 14px;
      border-radius:999px; border:1px solid rgba(2,132,199,.2);
      background:#ffffffbf; color:#0b1a2b; font-size:15px; font-weight:700;
    }
    .pbadge em{font-style:normal; color:#0b1a2b}

    /* Main card */
    main{max-width:1120px; margin:24px auto; padding:0 12px 80px}
    .card{border:var(--border); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden;
      background:linear-gradient(180deg, #ffffffcc, #ffffff)}
    .head{display:flex; flex-direction:column; gap:6px; padding:18px; border-bottom:var(--border);
      background:linear-gradient(180deg, #ffffff, #f7fdff)}
    .title{font-size:clamp(22px,3.4vw,32px); font-weight:800; margin:0}
    .subtitle{color:#0b1a2b; font-weight:700}
    .desc{color:#47667f}

    /* Progress */
    .progress{--h:10px; height:var(--h); margin:12px 18px; background:#e8f6ff; border:var(--border); border-radius:999px; overflow:hidden}
    .progress>span{display:block; height:100%; width:0; background:linear-gradient(90deg, var(--accent), var(--primary)); transition:width .4s ease}

    /* Form */
    form{padding:16px 18px 10px}
    .step{display:none; animation:fade .45s ease}
    .step.active{display:block}
    @keyframes fade{from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none}}
    .grid{display:grid; gap:12px}
    .g-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .g-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width:860px){.g-2,.g-3{grid-template-columns:1fr}}
    .field input,.field select,.field textarea{
      width:100%; background:#ffffff; color:var(--text); border:1px solid rgba(2,132,199,.26);
      padding:14px 12px; border-radius:12px; outline:none; transition:border .2s, box-shadow .2s; font-size:16px
    }
    .field input::placeholder,.field textarea::placeholder{color:#6c94ad}
    .field textarea{min-height:110px; resize:vertical}
    .field input:focus,.field select:focus,.field textarea:focus{ border-color:#0284c7; box-shadow:var(--focus) }
    .group{border:1px dashed rgba(2,132,199,.35); padding:12px; border-radius:12px; background:#ffffff}
    .group legend{font-weight:800; color:#0b1a2b}
    .checks{display:grid; gap:8px; grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:600px){ .checks{grid-template-columns:1fr} }
    .controls{display:flex; gap:12px; padding:14px 18px 18px}
    .controls .btn{flex:1}
    .btn{appearance:none; border:none; border-radius:12px; padding:14px 18px; cursor:pointer; font-weight:800; letter-spacing:.2px; font-size:16px}
    .btn.primary{color:#03131f; background:linear-gradient(90deg, #a7f3d0, #7dd3fc)}
    .btn.primary:hover{filter:saturate(110%)}
    .btn.ghost{background:#ffffff; color:#0b1a2b; border:1px solid rgba(2,132,199,.35)}
    .btn[disabled]{opacity:.65; cursor:not-allowed}
    .meta{color:var(--muted)}
    .success{display:none; text-align:center; padding:26px}
    .success.show{display:block; animation:pop .45s ease}
    @keyframes pop{from{opacity:0; transform:scale(.98)} to{opacity:1; transform:scale(1)}}
    .toast{position:fixed; right:16px; bottom:16px; background:#fff; color:#0b1a2b; border:1px solid rgba(2,132,199,.3); padding:12px 14px; border-radius:12px; box-shadow:var(--shadow);
      opacity:0; transform:translateY(8px); pointer-events:none; transition:all .3s}
    .toast.show{opacity:1; transform:none}
    .watermark{opacity:.6; font-size:12px; text-align:center; margin:14px 0 0}

    .download-cta{display:flex; flex-wrap:wrap; justify-content:center; align-items:center; gap:12px; margin-top:12px; padding:0 12px}
    .download-cta a, .download-cta button{
      display:inline-flex; gap:10px; align-items:center; text-decoration:none; color:#03131f;
      background:linear-gradient(90deg,#bef264,#7dd3fc); padding:14px 18px; border-radius:12px; font-weight:800; border:1px solid #bae6fd; cursor:pointer
    }
    .finish{background:linear-gradient(90deg,#fef08a,#93c5fd)}

    /* Modal (Welcome) */
    .modal{position:fixed; inset:0; background:linear-gradient(180deg, rgba(255,255,255,.6), rgba(255,255,255,.3)); display:flex; align-items:center; justify-content:center; z-index:9999}
    .modal-card{
      width:min(92vw, 720px); background:#ffffff; border:2px solid #93c5fd; border-radius:18px; 
      padding:16px; box-shadow:0 20px 60px rgba(2,132,199,.25);
      background-image: radial-gradient(600px 300px at 90% -10%, #fff1b1 0%, transparent 60%);
    }
    .modal h3{margin:0 0 8px 0; font-size:clamp(20px, 2.6vw, 26px); color:#0b1a2b}
    .modal .count{font-weight:900; color:#0b1a2b}

    /* Confirm modal (pregled) */
    .cmodal{position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:9998}
    .cwrap{width:min(96vw, 920px); max-height:90vh; overflow:auto; background:#fff; border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,.25); padding:16px}
    .cwrap h3{margin:0 0 8px 0}
    .review-grid{display:grid; grid-template-columns:220px 1fr; gap:8px 20px}
    @media (max-width:700px){ .review-grid{grid-template-columns:1fr} .review-grid .tt{margin-top:8px} }
    .tt{font-weight:700; color:#0b1a2b}
    .review-actions{display:flex; gap:10px; justify-content:flex-end; margin-top:12px}
    .review-actions .btn{border:1px solid #bae6fd}

    /* Mobile tweaks */
    @media (max-width:560px){
      .controls{flex-direction:column}
      .btn{width:100%}
      .title{font-size:22px}
    }
  </style>
</head>
<body>
  <!-- Dinamiƒçna pozadina po koracima -->
  <div class="hero-bg" id="hero"></div>

  <!-- Modal: Dobrodo≈°li (dugme aktivno nakon 7s, ne zatvara se samo) -->
  <div class="modal" id="welcomeModal" aria-modal="true" role="dialog">
    <div class="modal-card">
      <div style="display:flex; gap:12px; align-items:center">
        <img src="logo.png" alt="Centrotours" class="logo" />
        <div class="brand-soft">Centrotours ‚Ä¢ B2B Workshop</div>
      </div>
      <h3 style="margin-top:8px">Dobrodo≈°li na Centrotours B2B Workshop 2025</h3>
      <div class="badgeRow" style="margin:10px 0 6px 0">
        <span class="pbadge">üìç <em>Swissotel Sarajevo</em></span>
        <span class="pbadge">üóìÔ∏è <em>14. nov 2025</em></span>
        <span class="pbadge">‚è∞ <em>15:00‚Äì18:00</em></span>
        <span class="pbadge">üïí Prijave do: <em>6. nov 2025</em></span>
      </div>
      <p class="meta" style="margin:6px 0 0 0">
        Najveƒái turistiƒçki B2B event u BiH ‚Äì 100+ turistiƒçkih agenata ‚Ä¢ 30+ hotela¬†iz¬†Turske. 
        Poziv je upuƒáen odabranim partnerima ‚Äì ispunite prijavu kako bismo unaprijed zakazali termine Va≈°ih sastanaka.
      </p>
      <p class="meta" style="margin:6px 0 10px 0">Dugme ƒáe biti aktivno za <span class="count" id="countdown">7</span>s.</p>
      <button class="btn primary" id="closeWelcome" disabled>Zatvori</button>
    </div>
  </div>

  <!-- Confirm (Pregled) Modal -->
  <div class="cmodal" id="confirmModal">
    <div class="cwrap">
      <h3>Pregled unesenih podataka</h3>
      <div id="reviewBody" class="review-grid"></div>
      <div class="review-actions">
        <button class="btn ghost" id="editBtn">‚úèÔ∏è Uredi</button>
        <button class="btn primary" id="confirmSendBtn">‚úÖ Potvrdi i po≈°alji</button>
      </div>
    </div>
  </div>

  <header class="sticky">
    <div class="wrap">
      <div class="headerRow">
        <img src="logo.png" alt="Centrotours" class="logo" />
        <div class="brand-soft">Centrotours ‚Ä¢ B2B Workshop</div>
      </div>
      <div class="badgeRow">
        <span class="pbadge">üìç <em>Swissotel Sarajevo</em></span>
        <span class="pbadge">üóìÔ∏è <em>14. nov 2025</em></span>
        <span class="pbadge">‚è∞ <em>15:00‚Äì18:00</em></span>
        <span class="pbadge">üïí Prijave do: <em>6. nov 2025</em></span>
      </div>
    </div>
  </header>

  <main>
    <section class="card">
      <div class="head">
        <h1 class="title">Prijava na Centrotours Workshop | Ljeto 2026 u Turskoj</h1>
        <div class="subtitle">Poziv za odabrane partnere</div>
        <div class="desc">Dobrodo≈°li! Popunite podatke a na≈° tim ƒáe Vas kontaktirati radi potvrde termina sastanaka sa hotelima.</div>
      </div>

      <div class="progress"><span id="bar"></span></div>

      <form id="form" novalidate>
        <!-- Skriveno ID + honeypot -->
        <input type="hidden" name="entry_id" id="entry_id" />
        <input type="text" name="company" id="hp" style="display:none" tabindex="-1" autocomplete="off" />

        <!-- KORAK 1 -->
        <div class="step active" data-step="1">
          <p class="meta">Sva polja su obavezna. Kliknite ‚ÄúDalje‚Äù i pratite korake.</p>
        </div>

        <!-- KORAK 2: Osnovni podaci -->
        <div class="step" data-step="2">
          <div class="grid g-2">
            <div class="field"><input required name="nazivAgencije" placeholder="Naziv agencije *"/></div>
            <div class="field"><input required name="grad" placeholder="Grad / sjedi≈°te *"/></div>
            <div class="field"><input required name="web" placeholder="Web stranica (https://) *"/></div>
            <div class="field"><input required type="number" min="1" name="brojZaposlenih" placeholder="Broj zaposlenih *"/></div>
            <div class="field"><input required type="number" min="1900" max="2100" name="godinaOsnivanja" placeholder="Godina osnivanja *"/></div>
          </div>
        </div>

        <!-- KORAK 3: Kontakt -->
        <div class="step" data-step="3">
          <div class="grid g-2">
            <div class="field"><input required name="imePrezime" placeholder="Ime i prezime *"/></div>
            <div class="field"><input required name="pozicija" placeholder="Pozicija u agenciji *"/></div>
            <div class="field"><input required type="email" name="email" placeholder="E-mail *"/></div>
            <div class="field">
              <input required inputmode="numeric" pattern="^[0-9]{9,15}$" name="telefon" placeholder="Broj telefona / mobitel (samo cifre, 9‚Äì15) *" />
            </div>
          </div>
        </div>

        <!-- KORAK 4: Poslovni profil -->
        <div class="step" data-step="4">
          <fieldset class="group">
            <legend>Glavna tr≈æi≈°ta na kojima poslujete *</legend>
            <div class="checks">
              <label><input type="checkbox" name="trzista" value="Bosna i Hercegovina" required> Bosna i Hercegovina</label>
              <label><input type="checkbox" name="trzista" value="Hrvatska / Srbija / Crna Gora"> Hrvatska / Srbija / Crna Gora</label>
              <label><input type="checkbox" name="trzista" value="Zapadna Evropa"> Zapadna Evropa</label>
              <label><input type="checkbox" name="trzista" value="Bliski Istok"> Bliski Istok</label>
              <label><input type="checkbox" name="trzista" value="Ostalo"> Ostalo</label>
            </div>
          </fieldset>

          <fieldset class="group" style="margin-top:12px">
            <legend>Prosjeƒçan broj prodatih aran≈æmana godi≈°nje *</legend>
            <div class="checks">
              <label><input type="radio" required name="brojAranzmana" value="do 200"> do 200</label>
              <label><input type="radio" name="brojAranzmana" value="200‚Äì500"> 200‚Äì500</label>
              <label><input type="radio" name="brojAranzmana" value="500‚Äì1000"> 500‚Äì1000</label>
              <label><input type="radio" name="brojAranzmana" value="preko 1000"> preko 1000</label>
            </div>
          </fieldset>

          <fieldset class="group" style="margin-top:12px">
            <legend>Najƒçe≈°ƒáe destinacije koje nudite *</legend>
            <div class="checks">
              <label><input type="checkbox" name="destinacije" value="Turska" required> Turska</label>
              <label><input type="checkbox" name="destinacije" value="Egipat"> Egipat</label>
              <label><input type="checkbox" name="destinacije" value="Tunis"> Tunis</label>
              <label><input type="checkbox" name="destinacije" value="Grƒçka"> Grƒçka</label>
              <label><input type="checkbox" name="destinacije" value="Italija"> Italija</label>
              <label><input type="checkbox" name="destinacije" value="Ostalo"> Ostalo</label>
            </div>
          </fieldset>
        </div>

        <!-- KORAK 5: Interes (B2B) -->
        <div class="step" data-step="5">
          <fieldset class="group">
            <legend>Interes za sastanke (B2B dio) *</legend>
            <div class="checks">
              <label><input type="checkbox" name="sastanak" value="Porodiƒçni hoteli" required> Porodiƒçni hoteli</label>
              <label><input type="checkbox" name="sastanak" value="Adults Only hoteli"> Adults Only hoteli</label>
              <label><input type="checkbox" name="sastanak" value="Luksuzni resorti"> Luksuzni resorti</label>
              <label><input type="checkbox" name="sastanak" value="Hoteli sa velikim kapacitetima"> Veliki kapaciteti</label>
              <label><input type="checkbox" name="sastanak" value="Hoteli sa sportskim sadr≈æajima"> Sportski sadr≈æaji</label>
            </div>
          </fieldset>

          <div class="grid g-2" style="margin-top:12px">
            <div class="field"><input required type="number" min="1" name="brojOsoba" placeholder="Broj osoba iz va≈°e agencije *"/></div>
            <div class="group">
              <legend>Da li govorite engleski jezik? *</legend>
              <div class="checks">
                <label><input type="radio" required name="engleski" value="Da"> Da</label>
                <label><input type="radio" name="engleski" value="Ne"> Ne</label>
              </div>
            </div>
            <div class="field" style="grid-column:1/-1"><textarea required name="napomene" placeholder="Dodatne napomene ili posebni zahtjevi *"></textarea></div>
          </div>
        </div>

        <!-- KORAK 6: Logistika -->
        <div class="step" data-step="6">
          <div class="grid g-2">
            <div class="group">
              <legend>Da li planirate prisustvovati i veƒçeri nakon radionice (Networking Dinner u Swissotelu)?   *</legend>
              <div class="checks">
                <label><input type="radio" required name="vecera" value="Da"> Da</label>
                <label><input type="radio" name="vecera" value="Ne"> Ne</label>
              </div>
            </div>
            <div class="group">
              <legend>Potreban smje≈°taj u Sarajevu? *</legend>
              <div class="checks">
                <label><input type="radio" required name="smjestaj" value="Da"> Da (max. 1 soba po agenciji)</label>
                <label><input type="radio" name="smjestaj" value="Ne"> Ne</label>
              </div>
            </div>
            <div class="field" style="grid-column:1/-1">
              <textarea required name="parking" placeholder="Napomena za parking / dolazak *"></textarea>
            </div>
          </div>
        </div>

        <!-- KORAK 7: Saglasnost i potpis -->
        <div class="step" data-step="7">
          <div class="group">
            <p class="meta">‚úÖ Saglasan/na sam da Centrotours koristi navedene podatke u svrhu organizacije B2B radionice i daljnje poslovne komunikacije.</p>
            <label style="display:flex; gap:10px; align-items:center">
              <input type="checkbox" required name="saglasnost" value="DA"> Potvrƒëujem saglasnost *
            </label>
          </div>
          <div class="grid g-2" style="margin-top:12px">
            <div class="field"><input required name="potpis" placeholder="Potpis (ime i prezime) *"/></div>
          </div>
        </div>

        <div class="controls">
          <button type="button" class="btn ghost" id="prev">‚üµ Nazad</button>
          <button type="button" class="btn primary" id="next">Dalje ‚ü∂</button>
        </div>
      </form>

      <div class="success" id="success">
        <h2 style="margin:0 0 8px 0">üéâ Hvala vam na prijavi!</h2>
        <p class="meta">Va≈°a agencija je uspje≈°no registrovana. Preuzmite potvrdu radi validacije na ulazu.</p>
        <div class="download-cta">
          <a id="downloadLink" href="#" rel="noopener">üìÑ Preuzmi potvrdu (PDF)</a>
          <button type="button" class="finish" id="finishBtn">‚úÖ Zavr≈°i prijavu</button>
        </div>
        <p class="watermark">Vidimo se u Sarajevu 6.11! ‚Äî Va≈° Centrotours Team üíô</p>
      </div>
    </section>

    <p class="watermark">¬© Centrotours ‚Ä¢ B2B Workshop 2025</p>
  </main>

  <div class="toast" id="toast">Gre≈°ka pri slanju. Poku≈°ajte ponovo.</div>

  <!-- Dekorativni talas na dnu -->
  <svg style="position:fixed; left:0; right:0; bottom:-1px; z-index:-1; opacity:.35" width="100%" height="120" viewBox="0 0 1440 120" preserveAspectRatio="none" aria-hidden="true">
    <path d="M0,80 C240,140 480,0 720,60 C960,120 1200,20 1440,70 L1440,120 L0,120 Z" fill="#c7f1ff"/>
  </svg>

  <!-- Generisanje stilizovane potvrde (QR bez prikaza URL-a) -->
  <script>
  function buildConfirmationHTML(data, qrSrc){
    const base = location.origin + location.pathname.replace(/[^/]+$/,'');
    const css = `
      body{font-family:Arial,Helvetica,sans-serif; margin:0; color:#0f172a; background:#f8fafc}
      .wrap{max-width:940px; margin:40px auto; background:#fff; border:1px solid #e5e7eb; border-radius:14px; overflow:hidden;
            box-shadow:0 12px 40px rgba(2,132,199,.15)}
      .head{display:flex; justify-content:space-between; align-items:center; gap:16px; padding:18px 22px;
            background:linear-gradient(90deg,#e0f2fe,#f0fdf4)}
      .head img{height:38px}
      .title{margin:0; font-size:22px}
      .muted{color:#475569}
      .sec{padding:16px 22px; border-top:1px solid #e5e7eb}
      .h{font-weight:800; margin:0 0 10px 0}
      .grid{display:grid; grid-template-columns:220px 1fr; gap:8px 20px}
      @media (max-width:700px){ .grid{grid-template-columns:1fr} .grid .tt{margin-top:8px} }
      .tt{font-weight:700}
      .row{display:flex; flex-wrap:wrap; gap:16px; align-items:center; justify-content:space-between}
      .qr{width:160px; height:160px; border:1px solid #e5e7eb; padding:6px; background:#fff; border-radius:8px}
      .note{font-size:13px; color:#475569}
      .foot{font-size:12px; color:#6b7280; padding:10px 22px 18px}
      .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:#eef9ff; border:1px solid #bae6fd; color:#0b1a2b; font-weight:700}
      .why{display:grid; grid-template-columns:1fr 1fr; gap:14px}
      @media (max-width:700px){ .why{grid-template-columns:1fr} }
      .card{border:1px solid #e5e7eb; border-radius:10px; padding:12px; background:#fff}
      .card h4{margin:0 0 6px 0}
    `;
    const html = `
    <!doctype html><html><head><meta charset="utf-8"><title>Potvrda ${data.entry_id}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>${css}</style></head><body>
      <div class="wrap">
        <div class="head">
          <img src="${base}logo.png" alt="Centrotours"/>
          <div>
            <h1 class="title">Potvrda prijave ‚Ä¢ ID: ${data.entry_id}</h1>
            <div class="muted">Centrotours B2B Workshop 2025 ‚Ä¢ Swissotel Sarajevo ‚Ä¢ 14. nov 2025</div>
          </div>
          <a class="pill" href="#" onclick="window.print();return false;">üñ®Ô∏è Print / Saƒçuvaj PDF</a>
        </div>

        <div class="sec">
          <h3 class="h">Gdje i za≈°to</h3>
          <div class="why">
            <div class="card">
              <h4>Lokacija & vrijeme</h4>
              <div>üìç Swissotel Sarajevo</div>
              <div>üóìÔ∏è 14. nov 2025 ‚Ä¢ ‚è∞ 15:00‚Äì18:00</div>
              <div class="note">Ulaz uz skeniranje QR koda sa ove potvrde.</div>
            </div>
            <div class="card">
              <h4>Svrha</h4>
              <div>Najveƒái turistiƒçki B2B event u BiH ‚Äì 100+ turistiƒçkih agenata ‚Ä¢ 30+ hotela¬†iz¬†Turske.</div>
              <div class="note">Planirani su unaprijed zakazani sastanci (B2B) sa hotelskim partnerima.</div>
            </div>
          </div>
        </div>

        <div class="sec">
          <h3 class="h">Osnovne informacije o agenciji</h3>
          <div class="grid">
            <div class="tt">Naziv agencije</div><div>${data.nazivAgencije||''}</div>
            <div class="tt">Grad / sjedi≈°te</div><div>${data.grad||''}</div>
            <div class="tt">Web</div><div>${data.web||''}</div>
            <div class="tt">Broj zaposlenih</div><div>${data.brojZaposlenih||''}</div>
            <div class="tt">Godina osnivanja</div><div>${data.godinaOsnivanja||''}</div>
          </div>
        </div>

        <div class="sec">
          <h3 class="h">Kontakt osoba</h3>
          <div class="grid">
            <div class="tt">Ime i prezime</div><div>${data.imePrezime||''}</div>
            <div class="tt">Pozicija</div><div>${data.pozicija||''}</div>
            <div class="tt">E-mail</div><div>${data.email||''}</div>
            <div class="tt">Telefon</div><div>${data.telefon||''}</div>
          </div>
        </div>

        <div class="sec">
          <h3 class="h">B2B profil & logistika</h3>
          <div class="grid">
            <div class="tt">Tr≈æi≈°ta</div><div>${data.trzista||''}</div>
            <div class="tt">Destinacije</div><div>${data.destinacije||''}</div>
            <div class="tt">Aran≈æmana godi≈°nje</div><div>${data.brojAranzmana||''}</div>
            <div class="tt">Interes hotela</div><div>${data.sastanak||''}</div>
            <div class="tt">Broj osoba (B2B)</div><div>${data.brojOsoba||''}</div>
            <div class="tt">Engleski</div><div>${data.engleski||''}</div>
            <div class="tt">Networking Dinner</div><div>${data.vecera||''}</div>
            <div class="tt">Smje≈°taj</div><div>${data.smjestaj||''}</div>
            <div class="tt">Parking / dolazak</div><div>${String(data.parking||'').replace(/</g,'&lt;')}</div>
            <div class="tt">Saglasnost</div><div>${data.saglasnost?'DA':'NE'}</div>
            <div class="tt">Potpis</div><div>${data.potpis||''}</div>
          </div>
        </div>

        <div class="sec">
          <div class="row">
            <div>
              <div class="h" style="margin:0 0 6px 0;">QR pristup</div>
              <div class="note">Prika≈æite ovaj QR kod na ulazu radi validacije prijave.</div>
            </div>
            ${qrSrc 
              ? `<img class="qr" src="${qrSrc}" alt="QR"/>`
              : `<div class="qr" style="display:flex;align-items:center;justify-content:center;font-size:12px;color:#64748b;text-align:center">
                   QR nije dostupan
                 </div>`}
          </div>
        </div>

        <div class="foot">Generisano: ${new Date().toLocaleString()}</div>
      </div>
    </body></html>`;
    return html;
  }
  </script>

  <!-- Blob URL helper -->
  <script>
    let confirmationBlobUrl = null;
    function buildConfirmationBlobURL(htmlString){
      try{
        if (confirmationBlobUrl) URL.revokeObjectURL(confirmationBlobUrl);
        const blob = new Blob([htmlString], { type: 'text/html;charset=utf-8' });
        confirmationBlobUrl = URL.createObjectURL(blob);
        return confirmationBlobUrl;
      }catch(err){
        console.error('Blob pravljenje nije uspjelo:', err);
        return null;
      }
    }
  </script>

  <!-- App script -->
  <script>
    /* ===== KONFIG ===== */
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwFmjapQ8YCztkKhcYkwuYt5ocGfKlieVd_PKOymw6bVqvsTVrCPowsxcgvqzKuRrE/exec'; // <<< postavi va≈° /exec URL
    const bgByStep = {1:'destinacija-1.jpg',2:'destinacija-2.jpg',3:'destinacija-3.jpg',4:'hurgada.jpg',5:'destinacija-6.jpg',6:'destinacija-2.jpg',7:'destinacija-3.jpg'};

    /* ===== UI refs ===== */
    const form = document.getElementById('form');
    const steps = Array.from(document.querySelectorAll('.step'));
    const hero = document.getElementById('hero');
    const bar = document.getElementById('bar');
    const nextBtn = document.getElementById('next');
    const prevBtn = document.getElementById('prev');
    const toast = document.getElementById('toast');
    const success = document.getElementById('success');
    const entryHidden = document.getElementById('entry_id');
    const downloadLink = document.getElementById('downloadLink');
    const finishBtn = document.getElementById('finishBtn');

    // Confirm modal refs
    const cModal = document.getElementById('confirmModal');
    const reviewBody = document.getElementById('reviewBody');
    const editBtn = document.getElementById('editBtn');
    const confirmSendBtn = document.getElementById('confirmSendBtn');

    let current = 0;

    /* ===== Welcome modal (dugme aktivno nakon 7s) ===== */
    (function welcomeModalInit(){
      const modal = document.getElementById('welcomeModal');
      const btn   = document.getElementById('closeWelcome');
      const ctn   = document.getElementById('countdown');
      let s = 7;
      const tick = setInterval(()=>{
        s--; ctn.textContent = s;
        if(s<=0){
          clearInterval(tick);
          btn.disabled = false;
          btn.textContent = 'Zatvori';
        }
      }, 1000);
      btn.addEventListener('click', ()=>{ if(!btn.disabled) modal.style.display='none'; });
    })();

    /* ===== Helpers ===== */
    function setHero(stepIndex){
      const n = stepIndex + 1;
      hero.style.backgroundImage = `linear-gradient(rgba(255,255,255,.0),rgba(255,255,255,.0)), url('${bgByStep[n] || bgByStep[1]}')`;
    }
    function show(i){
      steps.forEach((el,idx)=>el.classList.toggle('active', idx===i));
      bar.style.width = (((i+1)/steps.length)*100) + '%';
      prevBtn.disabled = (i===0);
      nextBtn.textContent = (i===steps.length-1) ? 'Pregled i slanje' : 'Dalje ‚ü∂';
      setHero(i); window.scrollTo({top:0, behavior:'smooth'});
    }
    function showToast(msg){ toast.textContent = msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 3200); }

    function validateStep(){
      const active = steps[current];
      const inputs = active.querySelectorAll('input,select,textarea');

      // Polja (required + pattern)
      for(const el of inputs){
        if(el.type==='checkbox' || el.type==='radio') continue;
        if(el.hasAttribute('required') && !el.value.trim()){
          el.reportValidity?.(); return false;
        }
        if(el.pattern){
          const re = new RegExp(el.pattern);
          if(!re.test(el.value.trim())){ el.reportValidity?.(); return false; }
        }
      }
      // Checkbox grupe
      const groupChecks = [
        {sel:'legend', txt:'Glavna tr≈æi≈°ta', name:'trzista'},
        {sel:'legend', txt:'Najƒçe≈°ƒáe destinacije', name:'destinacije'},
        {sel:'legend', txt:'Interes za sastanke', name:'sastanak'}
      ];
      for(const g of groupChecks){
        if(active.querySelector(g.sel)?.textContent?.includes(g.txt)){
          if(active.querySelectorAll(`input[name="${g.name}"]:checked`).length===0){
            showToast(`Odaberite barem jednu stavku u "${g.txt}".`);
            return false;
          }
        }
      }
      // Radio grupe
      const radios = active.querySelectorAll('input[type="radio"][required]');
      if(radios.length){
        const name = radios[0].name;
        if(!active.querySelector(`input[name="${name}"]:checked`)){
          showToast('Odaberite jednu od ponuƒëenih opcija.'); return false;
        }
      }

      return true;
    }

    prevBtn.addEventListener('click', ()=>{ if(current>0){ current--; show(current); }});
    nextBtn.type='button';
    nextBtn.addEventListener('click', async ()=>{
      if(current < steps.length-1){
        if(!validateStep()) return;
        current++; show(current); return;
      }
      // Zadnji korak -> otvori pregled
      if(!validateStep()) return;
      openReview();
    });

    function openReview(){
      const data = gatherData();
      const rows = [
        ['Naziv agencije', data.nazivAgencije],
        ['Grad / sjedi≈°te', data.grad],
        ['Web', data.web],
        ['Broj zaposlenih', data.brojZaposlenih],
        ['Godina osnivanja', data.godinaOsnivanja],
        ['Ime i prezime', data.imePrezime],
        ['Pozicija', data.pozicija],
        ['E-mail', data.email],
        ['Telefon', data.telefon],
        ['Tr≈æi≈°ta', data.trzista],
        ['Aran≈æmana godi≈°nje', data.brojAranzmana],
        ['Destinacije', data.destinacije],
        ['Interes hotela', data.sastanak],
        ['Broj osoba (B2B)', data.brojOsoba],
        ['Engleski', data.engleski],
        ['Napomene', data.napomene],
        ['Networking Dinner', data.vecera],
        ['Smje≈°taj', data.smjestaj],
        ['Parking / dolazak', data.parking],
        ['Saglasnost', data.saglasnost ? 'DA' : 'NE'],
        ['Potpis', data.potpis]
      ];
      reviewBody.innerHTML = rows.map(([k,v])=>`<div class="tt">${k}</div><div>${(v||'').toString().replace(/</g,'&lt;')}</div>`).join('');
      cModal.style.display='flex';
    }
    editBtn.addEventListener('click', ()=>{ cModal.style.display='none'; });
    confirmSendBtn.addEventListener('click', async ()=>{
      cModal.style.display='none';
      await handleSubmit();
    });

    function makeID(){
      const d = new Date();
      const pad = (n)=>String(n).padStart(2,'0');
      return `CTS-${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}-${pad(d.getHours())}${pad(d.getMinutes())}${pad(d.getSeconds())}-${Math.random().toString(36).slice(2,6).toUpperCase()}`;
    }

    function gatherData(){
      const fd = new FormData(form); const o = {};
      for(const [k,v] of fd.entries()){
        if(o[k]){ o[k] = Array.isArray(o[k]) ? o[k].concat(v) : [o[k], v]; }
        else o[k]=v;
      }
      ['trzista','destinacije','sastanak'].forEach(k=>{
        if(Array.isArray(o[k])) o[k] = o[k].join(', ');
      });
      return o;
    }

    function openConfirmationFallback(html){
      const w = window.open("", "_blank", "noopener");
      if (!w) { alert("Dozvoli otvaranje pop-up prozora (novog taba)."); return; }
      w.document.open(); w.document.write(html); w.document.close();
    }

    // ‚Äî‚Äî‚Äî QR: robustno generisanje preko provjerenog API-ja (brzo i pouzdano)
    function makeQrSrc(verifyURL){
      // Ako ≈æeli≈° bez ikakvih eksternih servisa, mo≈æemo ubaciti pun JS generator.
      // Ovdje je provjeren image-endpoint koji telefoni ƒçitaju bez problema:
      return 'https://api.qrserver.com/v1/create-qr-code/?size=220x220&margin=0&data=' + encodeURIComponent(verifyURL);
    }

    async function handleSubmit(){
      // honeypot
      if((document.getElementById('hp').value||'').trim()){
        showToast('Gre≈°ka.'); return;
      }
      // telefon: samo cifre 9‚Äì15
      const tel = (form.telefon?.value || '').trim();
      if(!/^[0-9]{9,15}$/.test(tel)){
        showToast('Telefon: samo cifre, 9‚Äì15.'); form.telefon.focus(); return;
      }

      nextBtn.disabled=true; nextBtn.textContent='Slanje‚Ä¶';
      try{
        const id = makeID(); entryHidden.value = id;

        // PUNA verify adresa (za Apps Script /exec)
        const verifyURL = `${scriptURL.replace(/\/exec.*/, '/exec')}?verify=${encodeURIComponent(id)}`;

        // Sakupi podatke + pripremi FormData
        const data = gatherData(); data.entry_id = id; data.verifyURL = verifyURL;

        const fd = new FormData(form);
        fd.set('entry_id', id);
        fd.set('verifyURL', verifyURL);

        // SLANJE
        const res = await fetch(scriptURL, { method:'POST', body: fd });
        try{
          const j = await res.json();
          if(j && j.ok===false) throw new Error(j.error||'Gre≈°ka servera');
        }catch(_){ /* endpoint mo≈æda ne vraƒáa JSON ‚Äì ignori≈°i */ }

        // QR SRC sa PUNIM verifyURL (URL NIJE PRIKAZAN U POTVRDI)
        const qrSrc = makeQrSrc(verifyURL);

        // SIROVI HTML -> BLOB URL (stabilno otvaranje)
        const rawHTML = buildConfirmationHTML(data, qrSrc);
        const blobUrl = buildConfirmationBlobURL(rawHTML);

        if (blobUrl) {
          downloadLink.href = blobUrl;
          downloadLink.target = '_blank';
          downloadLink.rel = 'noopener';
          downloadLink.onclick = null;
        } else {
          downloadLink.href = '#';
          downloadLink.onclick = (e)=>{ e.preventDefault(); openConfirmationFallback(rawHTML); };
        }

        // UI final
        form.style.display='none'; 
        success.classList.add('show');

      }catch(err){
        console.error(err); showToast('Nije poslano: ' + (err.message||err));
      }finally{
        nextBtn.disabled=false; nextBtn.textContent='Pregled i slanje';
      }
    }

    // Zavr≈°i prijavu (ƒçisti stanje i vraƒáa na poƒçetak)
    finishBtn.addEventListener('click', ()=>{
      try{
        if(confirmationBlobUrl){ URL.revokeObjectURL(confirmationBlobUrl); confirmationBlobUrl=null; }
      }catch(_){}
      form.reset();
      success.classList.remove('show');
      form.style.display = '';
      current = 0; show(current);
      window.scrollTo({top:0, behavior:'smooth'});
    });

    // Navigacija
    prevBtn.addEventListener('click', ()=>{ if(current>0){ current--; show(current); }});
    nextBtn.type='button';

    // Confirm modal flow
    function openReview(){
      const data = gatherData();
      const rows = [
        ['Naziv agencije', data.nazivAgencije],
        ['Grad / sjedi≈°te', data.grad],
        ['Web', data.web],
        ['Broj zaposlenih', data.brojZaposlenih],
        ['Godina osnivanja', data.godinaOsnivanja],
        ['Ime i prezime', data.imePrezime],
        ['Pozicija', data.pozicija],
        ['E-mail', data.email],
        ['Telefon', data.telefon],
        ['Tr≈æi≈°ta', data.trzista],
        ['Aran≈æmana godi≈°nje', data.brojAranzmana],
        ['Destinacije', data.destinacije],
        ['Interes hotela', data.sastanak],
        ['Broj osoba (B2B)', data.brojOsoba],
        ['Engleski', data.engleski],
        ['Napomene', data.napomene],
        ['Networking Dinner', data.vecera],
        ['Smje≈°taj', data.smjestaj],
        ['Parking / dolazak', data.parking],
        ['Saglasnost', data.saglasnost ? 'DA' : 'NE'],
        ['Potpis', data.potpis]
      ];
      reviewBody.innerHTML = rows.map(([k,v])=>`<div class="tt">${k}</div><div>${(v||'').toString().replace(/</g,'&lt;')}</div>`).join('');
      cModal.style.display='flex';
    }
    editBtn.addEventListener('click', ()=>{ cModal.style.display='none'; });
    confirmSendBtn.addEventListener('click', async ()=>{ cModal.style.display='none'; await handleSubmit(); });

    // Init
    function init(){ setHero(0); show(0); }
    init();
  </script>
</body>
</html>
